---
// src/components/ContactForm.astro

// Get your free access key from https://web3forms.com
const web3FormsKey = '792ba9d3-ddbc-4450-8195-f57793e50462';
---

<form id="contact-form" class="space-y-6">
  <input type="hidden" name="access_key" value={web3FormsKey} />
  <input type="hidden" name="subject" value="New Contact Form Submission - Acme Blog" />

  <!-- Honeypot for spam prevention -->
  <input type="checkbox" name="botcheck" class="hidden" />

  <div class="grid md:grid-cols-2 gap-6">
    <!-- Name -->
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        Name
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
        placeholder="John Doe"
      />
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        Email
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
        placeholder="john@example.com"
      />
    </div>
  </div>

  <!-- Subject -->
  <div>
    <label for="subject-line" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
      Subject
    </label>
    <input
      type="text"
      id="subject-line"
      name="subject_line"
      required
      class="w-full px-4 py-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
      placeholder="How can we help?"
    />
  </div>

  <!-- Message -->
  <div>
    <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
      Message
    </label>
    <textarea
      id="message"
      name="message"
      rows="5"
      required
      class="w-full px-4 py-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors resize-none"
      placeholder="Tell us more about your project or question..."
    ></textarea>
  </div>

  <!-- Submit Button -->
  <div>
    <button
      type="submit"
      class="w-full md:w-auto px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors"
    >
      Send Message
    </button>
  </div>

  <!-- Status Message -->
  <div id="contact-message" class="hidden p-4 rounded-lg text-center"></div>
</form>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    var form = document.getElementById('contact-form');
    var messageEl = document.getElementById('contact-message');

    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();

        var button = form.querySelector('button[type="submit"]');
        var originalText = button.textContent;

        button.textContent = 'Sending...';
        button.disabled = true;

        try {
          var formData = new FormData(form);

          var response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            body: formData,
          });

          var data = await response.json();

          if (data.success) {
            messageEl.className = 'p-4 rounded-lg text-center bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400';
            messageEl.textContent = '✅ Message sent successfully! We\'ll get back to you soon.';
            messageEl.classList.remove('hidden');
            form.reset();
          } else {
            throw new Error(data.message || 'Something went wrong');
          }

        } catch (error) {
          messageEl.className = 'p-4 rounded-lg text-center bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400';
          messageEl.textContent = '❌ ' + (error.message || 'Something went wrong. Please try again.');
          messageEl.classList.remove('hidden');
        } finally {
          button.textContent = originalText;
          button.disabled = false;

          setTimeout(function() {
            messageEl.classList.add('hidden');
          }, 8000);
        }
      });
    }
  });
</script>